<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create new pdqr-function — new_p • pdqr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>

<meta property="og:title" content="Create new pdqr-function — new_p" />
<meta property="og:description" content="Functions for creating new pdqr-functions based on numeric sample or data
frame describing distribution. They construct appropriate &quot;x_tbl&quot; metadata based on the input and then create pdqr-function (of
corresponding pdqr class) defined by that &quot;x_tbl&quot;." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdqr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pdqr-01-create.html">Create pdqr-functions with `new_*()`</a>
    </li>
    <li>
      <a href="../articles/pdqr-02-convert.html">Convert pdqr-functions with `as_*()`</a>
    </li>
    <li>
      <a href="../articles/pdqr-03-transform.html">Transform pdqr-functions with `form_*()` and base operations</a>
    </li>
    <li>
      <a href="../articles/pdqr-04-summarize.html">Summarize pdqr-functions with `summ_*()`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/echasnovski/pdqr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create new pdqr-function</h1>
    <small class="dont-index">Source: <a href='https://github.com/echasnovski/pdqr/blob/master/R/new_p.R'><code>R/new_p.R</code></a>, <a href='https://github.com/echasnovski/pdqr/blob/master/R/new_d.R'><code>R/new_d.R</code></a>, <a href='https://github.com/echasnovski/pdqr/blob/master/R/new_q.R'><code>R/new_q.R</code></a>, and 3 more</small>
    <div class="hidden name"><code>new-pdqr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Functions for creating new pdqr-functions based on numeric sample or data
frame describing distribution. They construct appropriate <a href='meta.html'>"x_tbl" metadata</a> based on the input and then create pdqr-function (of
corresponding <a href='meta.html'>pdqr class</a>) defined by that "x_tbl".</p>
    </div>

    <pre class="usage"><code class = "r"><span class='fu'>new_p</span>(<span class='no'>x</span>, <span class='no'>type</span>, <span class='no'>...</span>)

<span class='fu'>new_d</span>(<span class='no'>x</span>, <span class='no'>type</span>, <span class='no'>...</span>)

<span class='fu'>new_q</span>(<span class='no'>x</span>, <span class='no'>type</span>, <span class='no'>...</span>)

<span class='fu'>new_r</span>(<span class='no'>x</span>, <span class='no'>type</span>, <span class='no'>...</span>)</code></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Numeric vector or data frame with appropriate columns (see "Data
frame input" section).</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><a href='meta.html'>Type</a> of pdqr-function. Should be one of "discrete"
or "continuous".</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Extra arguments for <a href='https://rdrr.io/r/stats/density.html'>density()</a>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A pdqr-function of corresponding <a href='meta.html'>class</a> ("p" for
<code>new_p()</code>, etc.) and <a href='meta.html'>type</a>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Data frame input <code>x</code> is treated as having enough information for
creating (including normalization of "y" column) an "x_tbl" metadata. For
more details see "Data frame input" section.</p>
<p>Numeric input is transformed into data frame which is then used as "x_tbl"
metadata (for more details see "Numeric input" section):</p><ul>
<li><p>If <code>type</code> is <code>"discrete"</code> then <code>x</code> is viewed as sample from distribution
that can produce only values from <code>x</code>. Input is tabulated and normalized to
form "x_tbl" metadata.</p></li>
<li><p>If <code>type</code> is <code>"continuous"</code> then:</p><ul>
<li><p>If <code>x</code> has 1 element, output distribution represents a <strong>dirac-like</strong>
distribution which is an approximation to singular dirac distribution.</p></li>
<li><p>If <code>x</code> has more than 1 element, output distribution represents a
<strong>density estimation</strong> with <a href='https://rdrr.io/r/stats/density.html'>density()</a> treating <code>x</code> as
sample.</p></li>
</ul></li>
</ul>

    <h2 class="hasAnchor" id="numeric-input"><a class="anchor" href="#numeric-input"></a>Numeric input</h2>

    


<p>If <code>x</code> is a numeric vector, it is transformed into a data frame which is then
used as <a href='meta.html'>"x_tbl" metadata</a> to create pdqr-function of
corresponding class.</p>
<p>First, all <code>NaN</code>, <code>NA</code>, and infinite values are removed with warnings. If
there are no elements left, error is thrown. Then data frame is created in
the way which depends on the <code>type</code> argument.</p>
<p><strong>For "discrete" type</strong> elements of filtered <code>x</code> are:</p><ul>
<li><p>Rounded to 10th digit to avoid numerical representation issues (see Note
in <code><a href='https://rdrr.io/r/base/Comparison.html'>==</a></code>'s help page).</p></li>
<li><p>Tabulated (all unique values are counted). Output data frame has three
columns: "x" with unique values, "prob" with normalized (divided by sum)
counts, "cumprob" with cumulative sum of "prob" column.</p></li>
</ul>

<p><strong>For "continuous" type</strong> output data frame has columns "x", "y", "cumprob".
Choice of algorithm depends on the number of <code>x</code> elements:</p><ul>
<li><p>If <code>x</code> has 1 element, an "x_tbl" metadata describes <strong>dirac-like</strong>
"continuous" pdqr-function. It is implemented as triangular peak with center
at <code>x</code>'s value and width of <code>2e-8</code> (see Examples). This is an approximation
of singular dirac distribution. Data frame has columns "x" with value
<code><a href='https://rdrr.io/r/base/c.html'>c(x-1e-8, x, x+1e-8)</a></code>, "y" with value <code><a href='https://rdrr.io/r/base/c.html'>c(0, 1e8, 0)</a></code> normalized to have
total integral of "x"-"y" points of 1, "cumprob" <code><a href='https://rdrr.io/r/base/c.html'>c(0, 0.5, 1)</a></code>.</p></li>
<li><p>If <code>x</code> has more than 1 element, it serves as input to
<a href='https://rdrr.io/r/stats/density.html'>density(x, ...)</a> for density estimation (here arguments in
<code>...</code> of <code>new_*()</code> serve as extra arguments to <code><a href='https://rdrr.io/r/stats/density.html'>density()</a></code>). The output's "x"
element is used as "x" column in output data frame. Column "y" is taken as
"y" element of <code><a href='https://rdrr.io/r/stats/density.html'>density()</a></code> output, normalized so that piecewise-linear
function passing through "x"-"y" points has total integral of 1. Column
"cumprob" has cumulative probability of piecewise-linear d-function.</p></li>
</ul>

    <h2 class="hasAnchor" id="data-frame-input"><a class="anchor" href="#data-frame-input"></a>Data frame input</h2>

    


<p>If <code>x</code> is a data frame, it should have numeric columns appropriate for
<a href='meta.html'>"x_tbl" metadata</a> of input <code>type</code>: "x", "prob" for "discrete"
<code>type</code> and "x", "y" for "continuous" type ("cumprob" column will be computed
inside <code>new_*()</code>). To become an appropriate "x_tbl" metadata, input data
frame is ordered in increasing order of "x" column and then <strong>imputed</strong> in
the way which depends on the <code>type</code> argument.</p>
<p><strong>For "discrete" type</strong>:</p><ul>
<li><p>Values in column "x" are rounded to 10th digit to avoid numerical
representation issues (see Note in <code><a href='https://rdrr.io/r/base/Comparison.html'>==</a></code>'s help page).</p></li>
<li><p>If there are duplicate values in "x" column, they are "squashed" into one
having sum of their probability in "prob" column.</p></li>
<li><p>Column "prob" is normalized by its sum to have total sum of 1.</p></li>
<li><p>Column "cumprob" is computed as cumulative sum of "prob" column.</p></li>
</ul>

<p><strong>For "continuous" type</strong> column "y" is normalized so that piecewise-linear
function passing through "x"-"y" points has total integral of 1. Column
"cumprob" has cumulative probability of piecewise-linear d-function.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><code class = "r"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>101</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>10</span>)

<span class='co'># Type "discrete": `x` values are directly tabulated</span>
<span class='no'>my_d_dis</span> <span class='kw'>&lt;-</span> <span class='fu'>new_d</span>(<span class='no'>x</span>, <span class='st'>"discrete"</span>)
<span class='fu'><a href='meta.html'>meta_x_tbl</a></span>(<span class='no'>my_d_dis</span>)</div><div class='output co'>#&gt;             x prob cumprob
#&gt; 1  -0.6749438  0.1     0.1
#&gt; 2  -0.3260365  0.1     0.2
#&gt; 3  -0.2232594  0.1     0.3
#&gt; 4  -0.1127343  0.1     0.4
#&gt; 5   0.2143595  0.1     0.5
#&gt; 6   0.3107692  0.1     0.6
#&gt; 7   0.5524619  0.1     0.7
#&gt; 8   0.6187899  0.1     0.8
#&gt; 9   0.9170283  0.1     0.9
#&gt; 10  1.1739663  0.1     1.0</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>my_d_dis</span>)</div><div class='img'><img src='new-pdqr-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Type "continuous": `x` serves as input to `density()`</span>
<span class='no'>my_d_con</span> <span class='kw'>&lt;-</span> <span class='fu'>new_d</span>(<span class='no'>x</span>, <span class='st'>"continuous"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'><a href='meta.html'>meta_x_tbl</a></span>(<span class='no'>my_d_con</span>))</div><div class='output co'>#&gt;           x           y      cumprob
#&gt; 1 -1.670523 0.001394314 0.000000e+00
#&gt; 2 -1.663008 0.001491008 1.084133e-05
#&gt; 3 -1.655493 0.001597622 2.244656e-05
#&gt; 4 -1.647979 0.001708323 3.486833e-05
#&gt; 5 -1.640464 0.001826333 4.814947e-05
#&gt; 6 -1.632949 0.001952627 6.234855e-05</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>my_d_con</span>)</div><div class='img'><img src='new-pdqr-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Data frame input</span>
  <span class='co'># Values in "prob" column will be normalized automatically</span>
<span class='no'>my_p_dis</span> <span class='kw'>&lt;-</span> <span class='fu'>new_p</span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>4</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>4</span>), <span class='st'>"discrete"</span>)
  <span class='co'># As are values in "y" column</span>
<span class='no'>my_p_con</span> <span class='kw'>&lt;-</span> <span class='fu'>new_p</span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>10</span>, <span class='fl'>0</span>)), <span class='st'>"continuous"</span>)

<span class='co'># Using bigger bandwidth in `density()`</span>
<span class='no'>my_d_con_2</span> <span class='kw'>&lt;-</span> <span class='fu'>new_d</span>(<span class='no'>x</span>, <span class='st'>"continuous"</span>, <span class='kw'>adjust</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>my_d_con</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"Comparison of density bandwidths"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>my_d_con_2</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)</div><div class='img'><img src='new-pdqr-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Dirac-like "continuous" pdqr-function is created if `x` is a single number</span>
<span class='fu'><a href='meta.html'>meta_x_tbl</a></span>(<span class='fu'>new_d</span>(<span class='fl'>1</span>, <span class='st'>"continuous"</span>))</div><div class='output co'>#&gt;   x     y cumprob
#&gt; 1 1 0e+00     0.0
#&gt; 2 1 1e+08     0.5
#&gt; 3 1 0e+00     1.0</div><div class='input'>
</div></code></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#numeric-input">Numeric input</a></li>
      <li><a href="#data-frame-input">Data frame input</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Evgeni Chasnovski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


